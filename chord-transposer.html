<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chord Dictionary Transposer</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        select {
            padding: 8px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 16px;
        }
        .content p {
            margin: 8px 0;
        }
        .monospace {
            font-family: monospace;
            background-color: #f5f5f5;
            padding: 8px;
            border-radius: 4px;
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <select id="rootSelect">
            <option value="C">C</option>
            <option value="C♯">C♯</option>
            <option value="D♭">D♭</option>
            <option value="D">D</option>
            <option value="D♯">D♯</option>
            <option value="E♭">E♭</option>
            <option value="E">E</option>
            <option value="F">F</option>
            <option value="F♯">F♯</option>
            <option value="G♭">G♭</option>
            <option value="G">G</option>
            <option value="G♯">G♯</option>
            <option value="A♭">A♭</option>
            <option value="A">A</option>
            <option value="A♯">A♯</option>
            <option value="B♭">B♭</option>
            <option value="B">B</option>
        </select>
        <select id="qualitySelect">
            <option value="">Select quality...</option>
        </select>
    </div>
    <div id="result" class="card" style="display: none">
        <div class="title" id="chordTitle"></div>
        <div class="content">
            <p id="fullName"></p>
            <p id="forteNumber"></p>
            <p id="intervals"></p>
            <p id="notes"></p>
            <p id="pcs"></p>
            <p id="aliases"></p>
            <div class="monospace">
                <p id="binary"></p>
                <p id="decimal"></p>
            </div>
        </div>
    </div>

    <script>
        const intervalToPc = {
            'R': 0, '♭2': 1, '2': 2, '♭3': 3, '3': 4, '4': 5, '♯4': 6,
            '♭5': 6, '5': 7, '♯5': 8, '♭6': 8, '6': 9, '♭7': 10, '7': 11,
            '𝄫7': 9, '♭9': 1, '9': 2, '♯9': 3, '11': 5, '♯11': 6, '♭13': 8, '13': 9
        };

        function getPC(note) {
            // Handle double accidentals
            if (note.includes('𝄪') || note.includes('♯♯')) {
                const baseLetter = note[0];
                const basePC = { 'C': 0, 'D': 2, 'E': 4, 'F': 5, 'G': 7, 'A': 9, 'B': 11 }[baseLetter];
                return (basePC + 2) % 12;
            }
            if (note.includes('♭♭')) {
                const baseLetter = note[0];
                const basePC = { 'C': 0, 'D': 2, 'E': 4, 'F': 5, 'G': 7, 'A': 9, 'B': 11 }[baseLetter];
                return (basePC - 2 + 12) % 12;
            }

            // Handle single accidentals
            const letter = note[0];
            const basePC = { 'C': 0, 'D': 2, 'E': 4, 'F': 5, 'G': 7, 'A': 9, 'B': 11 }[letter];
            
            if (note.includes('♯')) return (basePC + 1) % 12;
            if (note.includes('♭')) return (basePC - 1 + 12) % 12;
            return basePC;
        }

        function transposeNote(root, cNote) {
            if (root === 'C') return cNote;

            const interval = getPC(cNote);
            const rootPC = getPC(root);
            const targetPC = (interval + rootPC) % 12;

            // Get letter name based on root letter
            const letters = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
            const rootLetterIndex = letters.indexOf(root[0]);
            const cNoteLetterIndex = letters.indexOf(cNote[0]);
            const targetLetterIndex = (rootLetterIndex + cNoteLetterIndex) % 7;
            const targetLetter = letters[targetLetterIndex];

            // Calculate required accidentals
            const naturalPC = { 'C': 0, 'D': 2, 'E': 4, 'F': 5, 'G': 7, 'A': 9, 'B': 11 }[targetLetter];
            const needed = (targetPC - naturalPC + 12) % 12;

            if (needed === 0) return targetLetter;
            if (needed === 1) return targetLetter + '♯';
            if (needed === 2) return targetLetter + '𝄪';
            if (needed === 11) return targetLetter + '♭';
            if (needed === 10) return targetLetter + '♭♭';
            return targetLetter;
        }

        function transposeChord(root, quality, chordData) {
            if (!chordData[quality]) return null;
            const chord = chordData[quality];

            // If root is C, use the exact notes from JSON
            if (root === 'C') {
                return {
                    ...chord,
                    notes: chord.notes,
                    pcs: chord.pcs,
                    binary: chord.binary,
                    decimal: chord.decimal
                };
            }

            // Otherwise transpose from C
            const transposedNotes = chord.notes.map(cNote => transposeNote(root, cNote));
            const pcs = transposedNotes.map(note => getPC(note));
            
            // Generate binary from PCs
            const binary = Array(12).fill('0');
            pcs.forEach(pc => binary[pc] = '1');
            const binaryStr = binary.join('');
            
            return {
                ...chord,
                notes: transposedNotes,
                pcs,
                binary: binaryStr,
                decimal: parseInt(binaryStr, 2)
            };
        }

        let chordData = {};
        const qualitySelect = document.getElementById('qualitySelect');
        const rootSelect = document.getElementById('rootSelect');
        const resultDiv = document.getElementById('result');

        // Load chord dictionary
        fetch('chord_dictionary.json')
            .then(response => response.json())
            .then(data => {
                chordData = data;
                // Populate quality select
                Object.keys(data).sort().forEach(quality => {
                    const option = document.createElement('option');
                    option.value = quality;
                    option.textContent = quality;
                    qualitySelect.appendChild(option);
                });
            })
            .catch(error => console.error('Error loading chord data:', error));

        function updateChordDisplay() {
            const root = rootSelect.value;
            const quality = qualitySelect.value;
            
            if (!quality) {
                resultDiv.style.display = 'none';
                return;
            }

            const chord = transposeChord(root, quality, chordData);
            if (!chord) return;

            document.getElementById('chordTitle').textContent = `${root}${quality}`;
            document.getElementById('fullName').textContent = `Full Name: ${chord.fullName}`;
            document.getElementById('forteNumber').textContent = `Forte Number: ${chord.forteNumber}`;
            document.getElementById('intervals').textContent = `Intervals: [${chord.intervals.join(', ')}]`;
            document.getElementById('notes').textContent = `Notes: [${chord.notes.join(', ')}]`;
            document.getElementById('pcs').textContent = `Pitch Classes: [${chord.pcs.join(', ')}]`;
            document.getElementById('aliases').textContent = `Aliases: [${chord.aliases.join(', ')}]`;
            document.getElementById('binary').textContent = `Binary: ${chord.binary}`;
            document.getElementById('decimal').textContent = `Decimal: ${chord.decimal}`;

            resultDiv.style.display = 'block';
        }

        rootSelect.addEventListener('change', updateChordDisplay);
        qualitySelect.addEventListener('change', updateChordDisplay);
    </script>
</body>
</html>