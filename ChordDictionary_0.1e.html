<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chord Dictionary with Tests</title>
    <style>
        /* Existing styles */
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .container {
            background-color: #f5f5f5;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        pre {
            background-color: #eee;
            padding: 1rem;
            border-radius: 8px;
            overflow: auto;
            max-height: 300px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Chord Dictionary Tester</h1>
        <button onclick="runTests()">Run Tests</button>
        <h2>Test Results</h2>
        <pre id="testResults"></pre>
    </div>

    <script>
        let chordData;

        // Load chord dictionary JSON
        async function loadChordDictionary() {
            const response = await fetch('chord_dictionary.json');
            chordData = await response.json();
        }

        // Function to test PCS, notes, and transpositions
        function runTests() {
            const results = [];

            // Iterate over chord entries
            for (const [key, chord] of Object.entries(chordData)) {
                const { pcs, notes, transpositions } = chord;

                // Test PCS to binary and decimal
                const calculatedBinary = toBinaryPCS(pcs);
                const calculatedDecimal = parseInt(calculatedBinary, 2);

                if (calculatedBinary !== chord.binary) {
                    results.push(`Chord ${key} binary mismatch: Expected ${chord.binary}, Got ${calculatedBinary}`);
                }

                if (calculatedDecimal !== chord.decimal) {
                    results.push(`Chord ${key} decimal mismatch: Expected ${chord.decimal}, Got ${calculatedDecimal}`);
                }

                // Test transpositions
                for (const [root, transposition] of Object.entries(transpositions)) {
                    const { pcs: transposedPCS, notes: transposedNotes } = transposition;
                    const expectedPCS = transposePitchClassSet(pcs, noteToPC[root]);
                    if (!arraysEqual(transposedPCS, expectedPCS)) {
                        results.push(`Chord ${key} transposition mismatch for root ${root}: Expected PCS ${expectedPCS}, Got ${transposedPCS}`);
                    }

                    const expectedNotes = expectedPCS.map(pc => findNoteName(pc, root));
                    if (!arraysEqual(transposedNotes, expectedNotes)) {
                        results.push(`Chord ${key} note mismatch for root ${root}: Expected Notes ${expectedNotes}, Got ${transposedNotes}`);
                    }
                }
            }

            // Output results
            const resultElement = document.getElementById('testResults');
            resultElement.textContent = results.length > 0 ? results.join('\n') : 'All tests passed!';
        }

        // Helper functions
        function toBinaryPCS(pcs) {
            const binaryArray = Array(12).fill(0);
            pcs.forEach(pc => binaryArray[pc] = 1);
            return binaryArray.join('');
        }

        function transposePitchClassSet(pcs, interval) {
            return pcs.map(pc => (pc + interval) % 12);
        }

        function findNoteName(pc, root) {
            const noteOrder = Object.keys(noteToPC);
            const rootIndex = noteToPC[root];
            const noteIndex = (rootIndex + pc) % 12;
            return noteOrder.find(note => noteToPC[note] === noteIndex);
        }

        function arraysEqual(a, b) {
            if (a.length !== b.length) return false;
            for (let i = 0; i < a.length; i++) {
                if (a[i] !== b[i]) return false;
            }
            return true;
        }

        const noteToPC = {
            'C': 0, 'B#': 0, 'C#': 1, 'Db': 1,
            'D': 2, 'D#': 3, 'Eb': 3,
            'E': 4, 'Fb': 4, 'E#': 5,
            'F': 5, 'F#': 6, 'Gb': 6,
            'G': 7, 'G#': 8, 'Ab': 8,
            'A': 9, 'A#': 10, 'Bb': 10,
            'B': 11, 'Cb': 11
        };

        // Load the dictionary on page load
        loadChordDictionary();
    </script>
</body>
</html>
