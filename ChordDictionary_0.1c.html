<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Chord Dictionary</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
            background-color: #f9f9f9;
        }
        .container {
            background-color: #fff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .input-group {
            margin-bottom: 1rem;
        }
        input {
            padding: 0.5rem;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-right: 0.5rem;
            width: calc(100% - 1rem);
            margin-bottom: 1rem;
        }
        button {
            padding: 0.5rem 1rem;
            font-size: 1rem;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        #result {
            margin-top: 1rem;
            font-size: 1.1rem;
            background: #f7f7f7;
            padding: 1rem;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Enhanced Chord Dictionary</h1>
        <div class="input-group">
            <input type="text" id="chordInput" placeholder="Enter chord (e.g., Cmaj7)">
            <button id="findButton" onclick="findChordDetails()">Find</button>
        </div>
        <div id="result"></div>
    </div>

    <script>
        const chordData = {}; // Placeholder for JSON data

        async function loadChordData() {
            try {
                const response = await fetch('chord_dictionary_filtered.json');
                Object.assign(chordData, await response.json());
            } catch (error) {
                console.error('Failed to load chord data:', error);
            }
        }

        const noteToPC = {
            'C': 0, 'B#': 0, 'C#': 1, 'Db': 1,
            'D': 2, 'D#': 3, 'Eb': 3,
            'E': 4, 'Fb': 4, 'E#': 5,
            'F': 5, 'F#': 6, 'Gb': 6,
            'G': 7, 'G#': 8, 'Ab': 8,
            'A': 9, 'A#': 10, 'Bb': 10,
            'B': 11, 'Cb': 11
        };

        const pcToNote = {
            0: 'C',
            1: 'C#',
            2: 'D',
            3: 'D#',
            4: 'E',
            5: 'F',
            6: 'F#',
            7: 'G',
            8: 'G#',
            9: 'A',
            10: 'A#',
            11: 'B'
        };

        const intervalsMap = {
            0: 'R',
            1: '♭2',
            2: '2',
            3: '♭3',
            4: '3',
            5: '4',
            6: '♯4',
            7: '5',
            8: '♯5',
            9: '6',
            10: '♭7',
            11: '7'
        };

        function mod(a, b) {
            return ((a % b) + b) % b;
        }

        function getNoteName(pc, rootOffset) {
            const absolutePC = mod(pc + rootOffset, 12);
            return pcToNote[absolutePC];
        }

        function getNotes(root, pcs) {
            const rootPC = noteToPC[root];
            return pcs.map(pc => getNoteName(pc, rootPC));
        }

        function orderPitchClasses(pcs, root) {
            const rootPC = noteToPC[root];
            return pcs.map(pc => mod(pc - rootPC, 12)).sort((a, b) => a - b);
        }

        function calculateIntervals(pcs, root) {
            const rootPC = noteToPC[root];
            return pcs.map(pc => {
                const interval = mod(pc - rootPC, 12);
                return intervalsMap[interval] || '?';
            });
        }

        function findChordDetails() {
            const input = document.getElementById('chordInput').value.trim();
            if (!input) {
                alert('Please enter a chord.');
                return;
            }

            const match = input.match(/^([A-G][b#]?)(.*)$/);
            if (!match) {
                alert('Invalid chord format.');
                return;
            }

            const [_, root, quality] = match;
            const chord = chordData[quality];

            if (!chord) {
                alert('Chord quality not found.');
                return;
            }

            const orderedPCS = orderPitchClasses(chord.pcs, root);
            const notes = getNotes(root, orderedPCS);
            const intervals = calculateIntervals(orderedPCS, root);

            document.getElementById('result').innerHTML = `
                <h2>${root}${quality}</h2>
                <p>Pitch Classes: ${orderedPCS.join(', ')}</p>
                <p>Notes: ${notes.join(', ')}</p>
                <p>Intervals: ${intervals.join(', ')}</p>
            `;
        }

        function enableEnterKey() {
            document.getElementById('chordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    findChordDetails();
                }
            });
        }

        window.onload = () => {
            loadChordData();
            enableEnterKey();
        };
    </script>
</body>
</html>